<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Binance Price Helper</title>
</head>
<body>
  <h1>Crypto Prices:</h1>
  <div id="price">Loading...</div>
  <div id="candle">Loading...</div>
  <script>

    /* BINANCE PRICE DATA INTEGRATION */ 
    //https://developers.binance.com/docs/binance-spot-api-docs/rest-api/market-data-endpoints#symbol-price-ticker
    function getPriceBinanceAsync(base, quote){
        var symbol = base + quote;
        var priceEndPoint = "https://api.binance.com/api/v3/ticker/price?symbol="+symbol;
        
        return fetch(priceEndPoint)
        .then(response => response.json())
        .then(data => {
          const symbolPrice = parseFloat(data.price).toFixed(2); 
          return symbolPrice;
        })
        .catch(error => {console.log(error);
        });
    }

    async function showBinancePrice(){
      const price = await getPriceBinanceAsync("BTC", "USDT");
      document.getElementById("price").innerHTML = price;
    }
    showBinancePrice();

    /* BINANCE KLINE DATA INTEGRATION */
    //https://developers.binance.com/docs/binance-spot-api-docs/rest-api/market-data-endpoints#klinecandlestick-data

    //NAME	     |TYPE	  |MANDATORY	|DESCRIPTION
    //symbol	   |STRING	|YES	
    //interval	 |ENUM	  |YES	      |See klines
    //startTime	 |LONG	  |NO	
    //endTime	   |LONG	  |NO	
    //timeZone	 |STRING	|NO	        |Default: 0 (UTC)
    //limit	     |INT	    |NO	        |Default: 500; Maximum: 1000

    //seconds	1s
    //minutes	1m, 3m, 5m, 15m, 30m
    //hours	1h, 2h, 4h, 6h, 8h, 12h
    //days	1d, 3d
    //weeks	1w
    //months	1M


    // parseCandleData transforms raw Binance candlestick (kline) data into a more readable JSON format.
    // Each element in the rawData array is itself an array containing multiple values such as
    // timestamp, open, high, low, close, volume, etc.
    // This function maps each raw array to an object with meaningful property names and formats numeric values.
    function parseCandleData(rawData) {
      return rawData.map(candle => ({
        // The opening time of the candlestick in milliseconds since epoch
        openTime: candle[0],

        // The opening price of the candle, formatted to 2 decimal places
        openPrice: parseFloat(candle[1]).toFixed(2),

        // The highest price reached during the candle
        highPrice: parseFloat(candle[2]).toFixed(2),

        // The lowest price reached during the candle
        lowPrice: parseFloat(candle[3]).toFixed(2),

        // The closing price of the candle
        closePrice: parseFloat(candle[4]).toFixed(2),

        // The trading volume during the candle
        volume: parseFloat(candle[5]).toFixed(2)
      }));
    }

    function getCandleBinanceAsyn(base, quote, interval, limit){
      var symbol = base + quote;
      var candleEndpoint = "https://api.binance.com/api/v3/klines?symbol=" + symbol + "&interval=" + interval + "&limit=" + limit;
      
      return fetch(candleEndpoint)
      .then(response => response.json())
      .then(data=> {return parseCandleData(data);})
      .catch(error=>{console.log("Error: " + error);});
    }

    async function showBinanceCandles(){
      const candles = await getCandleBinanceAsyn("BTC","USDT","1h","5");
      document.getElementById("candle").innerHTML = JSON.stringify(candles, null,2);
    }
    
    showBinanceCandles();
  </script>
</body>
</html>
